<?xml version="1.0"?>
<robot name="camera_sensor" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!--
    camera_sensor macro
    params:
      parent_link   : link to mount on (e.g., base_link)
      frame_name    : camera link name (e.g., camera_link)
      xyz, rpy      : mount pose relative to parent_link
      mesh_uri      : (optional) package://... path to camera mesh
      mesh_scale    : (optional) "sx sy sz" (use 0.001 0.001 0.001 if mesh in mm)
      add_optical   : (true/false) add <frame_name>_optical per REP-103/145
  -->
  <xacro:macro name="camera_sensor"
               params="parent_link frame_name xyz rpy
                       topic_name:=/camera_out
                       mesh_uri:='' mesh_scale:='0.001 0.001 0.001'
                       add_optical:=true">

    <!-- Camera body link -->
    <link name="${frame_name}">
      <inertial>
        <mass value="0.12"/>
        <origin xyz="0 0 0"/>
        <inertia ixx="0.0002" iyy="0.0002" izz="0.0002" ixy="0" ixz="0" iyz="0"/>
      </inertial>

      <!-- Visual: mesh if provided, else simple box -->
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <xacro:if value="${mesh_uri != ''}">
            <mesh filename="${mesh_uri}" scale="${mesh_scale}"/>
          </xacro:if>
          <xacro:unless value="${mesh_uri != ''}">
            <box size="0.04 0.04 0.03"/>
          </xacro:unless>
        </geometry>
      </visual>

      <!-- Lightweight collision -->
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <box size="0.04 0.04 0.03"/>
        </geometry>
      </collision>
    </link>

    <!-- Fixed mount to the parent -->
    <joint name="${frame_name}_mount" type="fixed">
      <parent link="${parent_link}"/>
      <child  link="${frame_name}"/>
      <origin xyz="${xyz}" rpy="${rpy}"/>
    </joint>

    <!-- Optional optical frame (Z forward, X right, Y down) -->
    <xacro:if value="${add_optical}">
      <link name="${frame_name}_optical"/>
      <joint name="${frame_name}_optical_joint" type="fixed">
        <parent link="${frame_name}"/>
        <child  link="${frame_name}_optical"/>
        <!-- REP-103/145 rotation -->
        <origin xyz="0 0 0" rpy="-1.57079632679 0 -1.57079632679"/>
      </joint>
    </xacro:if>

  </xacro:macro>
</robot>
